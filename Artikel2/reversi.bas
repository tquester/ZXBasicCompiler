10 REM REVERSI WITH MINIMAX AI
20 REM ZX SPECTRUM BASIC
30 CLEAR 30000
40 DIM B(8,8): DIM M(64,2)
50 LET HUMAN=1: LET COMPUTER=2
60 LET EMPTY=0: LET MAXDEPTH=4
100 REM INITIALIZE BOARD
110 FOR I=1 TO 8
120 FOR J=1 TO 8
130 LET B(I,J)=EMPTY
140 NEXT J
150 NEXT I
160 LET B(4,4)=2: LET B(5,5)=2
170 LET B(4,5)=1: LET B(5,4)=1
180 LET PLAYER=HUMAN
200 REM MAIN GAME 
210 CLS
220 GO SUB 2000: REM DRAW BOARD
230 GO SUB 2200: REM SHOW SCORE
240 GO SUB 1000: REM CHECK VALID MOVES
250 IF MOVES=0 THEN GOTO 280
260 IF PLAYER=HUMAN THEN GO SUB 3000: REM HUMAN MOVE
270 IF PLAYER=COMPUTER THEN GO SUB 4000: REM AI MOVE
280 GO SUB 1200: REM SWITCH PLAYER
290 GO SUB 1400: REM CHECK GAME END
300 IF GAMEEND=0 THEN GOTO 210
310 GO SUB 2400: REM SHOW FINAL RESULT
320 GOTO 9000

1000 REM CHECK VALID MOVES
1010 LET MOVES=0
1020 FOR I=1 TO 8
1030 FOR J=1 TO 8
1040 IF B(I,J)<>EMPTY THEN GOTO 1080
1050 GO SUB 1100: REM CHECK IF VALID
1060 IF VALID=1 THEN LET MOVES=MOVES+1: LET M(MOVES,1)=I: LET M(MOVES,2)=J
1080 NEXT J
1090 NEXT I
1095 RETURN

1100 REM CHECK IF MOVE IS VALID
1110 LET VALID=0
1120 FOR DX=-1 TO 1
1130 FOR DY=-1 TO 1
1140 IF DX=0 AND DY=0 THEN GOTO 1180
1150 LET X=I+DX: LET Y=J+DY
1160 IF X<1 OR X>8 OR Y<1 OR Y>8 THEN GOTO 1180
1170 IF B(X,Y)=0 OR B(X,Y)=PLAYER THEN GOTO 1180
1175 REM FOUND OPPONENT PIECE, CHECK LINE
1176 LET X=X+DX: LET Y=Y+DY
1177 IF X<1 OR X>8 OR Y<1 OR Y>8 THEN GOTO 1180
1178 IF B(X,Y)=0 THEN GOTO 1180
1179 IF B(X,Y)=PLAYER THEN LET VALID=1: RETURN
1180 NEXT DY
1190 NEXT DX
1195 RETURN

1200 REM SWITCH PLAYER
1210 IF PLAYER=HUMAN THEN LET PLAYER=COMPUTER: RETURN
1220 LET PLAYER=HUMAN
1230 RETURN

1400 REM CHECK GAME END
1410 LET GAMEEND=0
1420 LET OLDPLAYER=PLAYER
1430 GO SUB 1000: LET MOVES1=MOVES
1440 GO SUB 1200
1450 GO SUB 1000: LET MOVES2=MOVES
1460 LET PLAYER=OLDPLAYER
1470 IF MOVES1=0 AND MOVES2=0 THEN LET GAMEEND=1
1480 RETURN

2000 REM DRAW BOARD
2010 PRINT "  12345678"
2020 FOR I=1 TO 8
2030 PRINT CHR$(64+I);
2040 FOR J=1 TO 8
2050 IF B(I,J)=EMPTY THEN PRINT ".";
2060 IF B(I,J)=HUMAN THEN PRINT "X";
2070 IF B(I,J)=COMPUTER THEN PRINT "O";
2080 NEXT J
2090 PRINT
2100 NEXT I
2110 RETURN

2200 REM SHOW SCORE
2210 LET HSCORE=0: LET CSCORE=0
2220 FOR I=1 TO 8
2230 FOR J=1 TO 8
2240 IF B(I,J)=HUMAN THEN LET HSCORE=HSCORE+1
2250 IF B(I,J)=COMPUTER THEN LET CSCORE=CSCORE+1
2260 NEXT J
2270 NEXT I
2280 PRINT "Human: ";HSCORE;" Computer: ";CSCORE
2290 RETURN

2400 REM SHOW FINAL RESULT
2410 PRINT "GAME OVER!"
2420 IF HSCORE>CSCORE THEN PRINT "Human wins!"
2430 IF CSCORE>HSCORE THEN PRINT "Computer wins!"
2440 IF HSCORE=CSCORE THEN PRINT "It's a tie!"
2450 RETURN

3000 REM HUMAN MOVE
3010 PRINT "Your turn (e.g. A1): ";
3020 INPUT MOVE$
3030 IF LEN MOVE$<>2 THEN GOTO 3010
3040 LET ROW=CODE(MOVE$(1))-64
3050 LET COL=VAL(MOVE$(2))
3060 IF ROW<1 OR ROW>8 OR COL<1 OR COL>8 THEN GOTO 3010
3070 IF B(ROW,COL)<>EMPTY THEN GOTO 3010
3080 LET I=ROW: LET J=COL
3090 GO SUB 1100
3100 IF VALID=0 THEN PRINT "Invalid move!": GOTO 3010
3110 GO SUB 3200: REM MAKE MOVE
3120 RETURN

3200 REM MAKE MOVE
3210 LET B(I,J)=PLAYER
3220 FOR DX=-1 TO 1
3230 FOR DY=-1 TO 1
3240 IF DX=0 AND DY=0 THEN GOTO 3320
3250 LET X=I+DX: LET Y=J+DY
3260 LET FLIPS=0
3270 IF X<1 OR X>8 OR Y<1 OR Y>8 THEN GOTO 3320
3280 IF B(X,Y)=0 OR B(X,Y)=PLAYER THEN GOTO 3320
3290 LET X=X+DX: LET Y=Y+DY: LET FLIPS=FLIPS+1
3300 IF X>=1 AND X<=8 AND Y>=1 AND Y<=8 AND B(X,Y)<>0 THEN GOTO 3280
3310 IF X>=1 AND X<=8 AND Y>=1 AND Y<=8 AND B(X,Y)=PLAYER AND FLIPS>0 THEN GO SUB 3400
3320 NEXT DY
3330 NEXT DX
3340 RETURN

3400 REM FLIP PIECES
3410 LET X=I+DX: LET Y=J+DY
3420 IF X<1 OR X>8 OR Y<1 OR Y>8 THEN RETURN
3430 IF B(X,Y)=PLAYER THEN RETURN
3440 LET B(X,Y)=PLAYER
3450 LET X=X+DX: LET Y=Y+DY
3460 GOTO 3420

4000 REM AI MOVE (MINIMAX)
4010 PRINT "Computer thinking..."
4020 LET BESTSCORE=-1000
4030 LET BESTMOVE=1
4040 FOR MOVENUM=1 TO MOVES
4050 LET I=M(MOVENUM,1): LET J=M(MOVENUM,2)
4060 GO SUB 5000: REM COPY BOARD
4070 GO SUB 3200: REM MAKE MOVE
4080 LET DEPTH=1
4090 GO SUB 6000: REM MINIMAX
4100 GO SUB 5200: REM RESTORE BOARD
4110 IF SCORE>BESTSCORE THEN LET BESTSCORE=SCORE: LET BESTMOVE=MOVENUM
4120 NEXT MOVENUM
4130 LET I=M(BESTMOVE,1): LET J=M(BESTMOVE,2)
4140 GO SUB 3200
4150 PRINT "Computer plays ";CHR$(64+I);J
4160 RETURN

5000 REM COPY BOARD TO BACKUP
5010 FOR X=1 TO 8
5020 FOR Y=1 TO 8
5030 LET BACKUP(X,Y)=B(X,Y)
5040 NEXT Y
5050 NEXT X
5060 RETURN

5200 REM RESTORE BOARD FROM BACKUP
5210 FOR X=1 TO 8
5220 FOR Y=1 TO 8
5230 LET B(X,Y)=BACKUP(X,Y)
5240 NEXT Y
5250 NEXT X
5260 RETURN

6000 REM MINIMAX ALGORITHM
6010 IF DEPTH>=MAXDEPTH THEN GO SUB 7000: RETURN
6020 GO SUB 1200: REM SWITCH PLAYER
6030 GO SUB 1000: REM GET MOVES
6040 IF MOVES=0 THEN GO SUB 1200: GO SUB 7000: RETURN
6050 IF PLAYER=COMPUTER THEN LET SCORE=-1000: GOTO 6100
6060 LET SCORE=1000
6100 FOR MOVENUM=1 TO MOVES
6110 LET I=M(MOVENUM,1): LET J=M(MOVENUM,2)
6120 GO SUB 5000
6130 GO SUB 3200
6140 LET DEPTH=DEPTH+1
6150 GO SUB 6000
6160 LET DEPTH=DEPTH-1
6170 GO SUB 5200
6180 IF PLAYER=COMPUTER AND SCORE<CHILDSCORE THEN LET SCORE=CHILDSCORE
6190 IF PLAYER=HUMAN AND SCORE>CHILDSCORE THEN LET SCORE=CHILDSCORE
6200 NEXT MOVENUM
6210 GO SUB 1200: REM SWITCH BACK
6220 LET CHILDSCORE=SCORE
6230 RETURN

7000 REM EVALUATE POSITION
7010 LET SCORE=0
7020 FOR X=1 TO 8
7030 FOR Y=1 TO 8
7040 IF B(X,Y)=COMPUTER THEN LET SCORE=SCORE+1
7050 IF B(X,Y)=HUMAN THEN LET SCORE=SCORE-1
7060 NEXT Y
7070 NEXT X
7080 REM CORNER BONUS
7090 IF B(1,1)=COMPUTER THEN LET SCORE=SCORE+10
7100 IF B(1,8)=COMPUTER THEN LET SCORE=SCORE+10
7110 IF B(8,1)=COMPUTER THEN LET SCORE=SCORE+10
7120 IF B(8,8)=COMPUTER THEN LET SCORE=SCORE+10
7130 IF B(1,1)=HUMAN THEN LET SCORE=SCORE-10
7140 IF B(1,8)=HUMAN THEN LET SCORE=SCORE-10
7150 IF B(8,1)=HUMAN THEN LET SCORE=SCORE-10
7160 IF B(8,8)=HUMAN THEN LET SCORE=SCORE-10
7170 LET CHILDSCORE=SCORE
7180 RETURN

8000 REM ADDITIONAL ARRAYS
8010 DIM BACKUP(8,8)
8020 RETURN
9000 STOP
